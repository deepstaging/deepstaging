// <auto-generated/>
// SPDX-License-Identifier: RPL-1.5
// Copyright (c) Deepstaging contributors. All rights reserved.
// Licensed under the Reciprocal Public License 1.5 (RPL-1.5).
// See LICENSE file in the project root for full license information.
#nullable enable
using LanguageExt;
using Microsoft.EntityFrameworkCore;
using System.Linq;
using System.Linq.Expressions;
using System.Threading;
using static LanguageExt.Prelude;

namespace Deepstaging.Effects;
/// <summary>
/// A composable query builder for DbSet that accumulates LINQ expressions and materializes to an Eff only on terminal operations.
/// </summary>
/// <typeparam name="RT">The runtime type that provides the DbContext capability.</typeparam>
/// <typeparam name="T">The entity type of the DbSet being queried.</typeparam>
public sealed class DbSetQuery<RT, T>(global::System.Func<RT, global::System.Linq.IQueryable<T>> query)
    where T : class
{
#region Filtering Operations
    /// <summary>
    /// Filters the sequence based on a predicate.
    /// </summary>
    /// <param name="predicate">The LINQ expression representing the filter condition.</param>
    /// <returns>A new query instance with the added filter.</returns>
    public DbSetQuery<RT, T> Where(global::System.Linq.Expressions.Expression<global::System.Func<T, bool>> predicate) => new DbSetQuery<RT, T>(rt => query(rt).Where(predicate));
#endregion
#region Ordering Operations
    /// <summary>
    /// Sorts the elements in ascending order.
    /// </summary>
    /// <param name="keySelector">The LINQ expression representing the key to sort by.</param>
    /// <returns>A new ordered query instance.</returns>
    public DbSetOrderedQuery OrderBy<TKey>(global::System.Linq.Expressions.Expression<global::System.Func<T, TKey>> keySelector) => new DbSetOrderedQuery(rt => query(rt).OrderBy(keySelector));
    /// <summary>
    /// Sorts the elements in descending order.
    /// </summary>
    /// <param name="keySelector">The LINQ expression representing the key to sort by.</param>
    /// <returns>A new ordered query instance.</returns>
    public DbSetOrderedQuery OrderByDescending<TKey>(global::System.Linq.Expressions.Expression<global::System.Func<T, TKey>> keySelector) => new DbSetOrderedQuery(rt => query(rt).OrderByDescending(keySelector));
#endregion
#region Eager Loading Operations
    /// <summary>
    /// Includes a related entity in the query results.
    /// </summary>
    /// <param name="navigationPropertyPath">The navigation property to include.</param>
    /// <returns>A new query instance with the eager loading applied.</returns>
    public DbSetQuery<RT, T> Include<TProperty>(global::System.Linq.Expressions.Expression<global::System.Func<T, TProperty>> navigationPropertyPath) => new DbSetQuery<RT, T>(rt => query(rt).Include(navigationPropertyPath));
    /// <summary>
    /// Includes a related entity using a string path.
    /// </summary>
    /// <param name="navigationPropertyPath">The string navigation property path to include.</param>
    /// <returns>A new query instance with the eager loading applied.</returns>
    public DbSetQuery<RT, T> Include(string navigationPropertyPath) => new DbSetQuery<RT, T>(rt => query(rt).Include(navigationPropertyPath));
#endregion
#region Pagination Operations
    /// <summary>
    /// Bypasses a specified number of elements.
    /// </summary>
    /// <param name="count">The number of elements to skip.</param>
    /// <returns>A new query instance with the skip applied.</returns>
    public DbSetQuery<RT, T> Skip(int count) => new DbSetQuery<RT, T>(rt => query(rt).Skip(count));
    /// <summary>
    /// Returns a specified number of elements.
    /// </summary>
    /// <param name="count">The number of elements to return.</param>
    /// <returns>A new query instance with the take applied.</returns>
    public DbSetQuery<RT, T> Take(int count) => new DbSetQuery<RT, T>(rt => query(rt).Take(count));
#endregion
#region Projection Operations
    /// <summary>
    /// Projects each element to a new form.
    /// </summary>
    /// <param name="selector">The projection expression.</param>
    /// <returns>A new query instance projecting to the result type.</returns>
    public DbSetQuery<RT, TResult> Select<TResult>(global::System.Linq.Expressions.Expression<global::System.Func<T, TResult>> selector)
        where TResult : class => new DbSetQuery<RT, TResult>(rt => query(rt).Select(selector));
    /// <summary>
    /// Projects and flattens sequences.
    /// </summary>
    /// <param name="selector">The projection expression.</param>
    /// <returns>A new query instance projecting and flattening to the result type.</returns>
    public DbSetQuery<RT, TResult> SelectMany<TResult>(global::System.Linq.Expressions.Expression<global::System.Func<T, global::System.Collections.Generic.IEnumerable<TResult>>> selector)
        where TResult : class => new DbSetQuery<RT, TResult>(rt => query(rt).SelectMany(selector));
#endregion
#region Set Operations
    /// <summary>
    /// Returns distinct elements.
    /// </summary>
    /// <returns>A new query instance with distinct applied.</returns>
    public DbSetQuery<RT, T> Distinct() => new DbSetQuery<RT, T>(rt => Queryable.Distinct(query(rt)));
#endregion
#region Tracking Operations
    /// <summary>
    /// Disables change tracking for the query.
    /// </summary>
    /// <returns>A new query instance with no tracking.</returns>
    public DbSetQuery<RT, T> AsNoTracking() => new DbSetQuery<RT, T>(rt => query(rt).AsNoTracking());
    /// <summary>
    /// Disables change tracking but enables identity resolution.
    /// </summary>
    /// <returns>A new query instance with identity resolution tracking.</returns>
    public DbSetQuery<RT, T> AsNoTrackingWithIdentityResolution() => new DbSetQuery<RT, T>(rt => query(rt).AsNoTrackingWithIdentityResolution());
    /// <summary>
    /// Enables change tracking.
    /// </summary>
    /// <returns>A new query instance with tracking enabled.</returns>
    public DbSetQuery<RT, T> AsTracking() => new DbSetQuery<RT, T>(rt => query(rt).AsTracking());
#endregion
#region Terminal Effects
    /// <summary>
    /// Executes the query and returns all results as a list.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields a list of all matching elements.</returns>
    public global::LanguageExt.Eff<RT, global::System.Collections.Generic.List<T>> ToListAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, global::System.Collections.Generic.List<T>>.LiftIO(async rt => await query(rt).ToListAsync(token));
    /// <summary>
    /// Executes the query and returns all results as an array.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields an array of all matching elements.</returns>
    public global::LanguageExt.Eff<RT, T[]> ToArrayAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, T[]>.LiftIO(async rt => await query(rt).ToArrayAsync(token));
    /// <summary>
    /// Returns the first element, or None if the sequence is empty.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the first element wrapped in an Option, or None.</returns>
    public global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>> FirstOrNoneAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>>.LiftIO(async rt => Optional(await query(rt).FirstOrDefaultAsync(token)));
    /// <summary>
    /// Returns the first element matching the predicate, or None if not found.
    /// </summary>
    /// <param name="predicate">The LINQ expression representing the filter condition.</param>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the matching element wrapped in an Option, or None.</returns>
    public global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>> FirstOrNoneAsync(global::System.Linq.Expressions.Expression<global::System.Func<T, bool>> predicate, CancellationToken token = default) => global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>>.LiftIO(async rt => Optional(await query(rt).FirstOrDefaultAsync(predicate, token)));
    /// <summary>
    /// Returns the single element, or None if empty. Throws if more than one element exists.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the single element wrapped in an Option, or None.</returns>
    public global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>> SingleOrNoneAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>>.LiftIO(async rt => Optional(await query(rt).SingleOrDefaultAsync(token)));
    /// <summary>
    /// Returns the single element matching the predicate, or None. Throws if more than one element matches.
    /// </summary>
    /// <param name="predicate">The LINQ expression representing the filter condition.</param>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the matching element wrapped in an Option, or None.</returns>
    public global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>> SingleOrNoneAsync(global::System.Linq.Expressions.Expression<global::System.Func<T, bool>> predicate, CancellationToken token = default) => global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>>.LiftIO(async rt => Optional(await query(rt).SingleOrDefaultAsync(predicate, token)));
    /// <summary>
    /// Returns the count of elements in the sequence.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the number of elements.</returns>
    public global::LanguageExt.Eff<RT, int> CountAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, int>.LiftIO(async rt => await query(rt).CountAsync(token));
    /// <summary>
    /// Returns the count of elements matching the predicate.
    /// </summary>
    /// <param name="predicate">The LINQ expression representing the filter condition.</param>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the number of matching elements.</returns>
    public global::LanguageExt.Eff<RT, int> CountAsync(global::System.Linq.Expressions.Expression<global::System.Func<T, bool>> predicate, CancellationToken token = default) => global::LanguageExt.Eff<RT, int>.LiftIO(async rt => await query(rt).CountAsync(predicate, token));
    /// <summary>
    /// Returns the count of elements as a 64-bit integer.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the number of elements as a &lt;see langword=&quot;long&quot; /&gt;.</returns>
    public global::LanguageExt.Eff<RT, long> LongCountAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, long>.LiftIO(async rt => await query(rt).LongCountAsync(token));
    /// <summary>
    /// Determines whether the sequence contains any elements.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields &lt;see langword=&quot;true&quot; /&gt; if the sequence contains any elements.</returns>
    public global::LanguageExt.Eff<RT, bool> AnyAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, bool>.LiftIO(async rt => await query(rt).AnyAsync(token));
    /// <summary>
    /// Determines whether any element satisfies the predicate.
    /// </summary>
    /// <param name="predicate">The LINQ expression representing the filter condition.</param>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields &lt;see langword=&quot;true&quot; /&gt; if any element matches the predicate.</returns>
    public global::LanguageExt.Eff<RT, bool> AnyAsync(global::System.Linq.Expressions.Expression<global::System.Func<T, bool>> predicate, CancellationToken token = default) => global::LanguageExt.Eff<RT, bool>.LiftIO(async rt => await query(rt).AnyAsync(predicate, token));
    /// <summary>
    /// Determines whether all elements satisfy the predicate.
    /// </summary>
    /// <param name="predicate">The LINQ expression representing the filter condition.</param>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields &lt;see langword=&quot;true&quot; /&gt; if every element matches the predicate.</returns>
    public global::LanguageExt.Eff<RT, bool> AllAsync(global::System.Linq.Expressions.Expression<global::System.Func<T, bool>> predicate, CancellationToken token = default) => global::LanguageExt.Eff<RT, bool>.LiftIO(async rt => await query(rt).AllAsync(predicate, token));
#endregion
#region Aggregate Operations
    /// <summary>
    /// Returns the maximum value in the sequence.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the maximum value.</returns>
    public global::LanguageExt.Eff<RT, T> MaxAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, T>.LiftIO(async rt => (await query(rt).MaxAsync(token))!);
    /// <summary>
    /// Returns the maximum value of the selected projection.
    /// </summary>
    /// <typeparam name="TResult">The type of the projected value.</typeparam>
    /// <param name="selector">The projection expression to apply to each element.</param>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the maximum projected value.</returns>
    public global::LanguageExt.Eff<RT, TResult> MaxAsync<TResult>(global::System.Linq.Expressions.Expression<global::System.Func<T, TResult>> selector, CancellationToken token = default) => global::LanguageExt.Eff<RT, TResult>.LiftIO(async rt => (await query(rt).MaxAsync(selector, token))!);
    /// <summary>
    /// Returns the minimum value in the sequence.
    /// </summary>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the minimum value.</returns>
    public global::LanguageExt.Eff<RT, T> MinAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, T>.LiftIO(async rt => (await query(rt).MinAsync(token))!);
    /// <summary>
    /// Returns the minimum value of the selected projection.
    /// </summary>
    /// <typeparam name="TResult">The type of the projected value.</typeparam>
    /// <param name="selector">The projection expression to apply to each element.</param>
    /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
    /// <returns>An effect that yields the minimum projected value.</returns>
    public global::LanguageExt.Eff<RT, TResult> MinAsync<TResult>(global::System.Linq.Expressions.Expression<global::System.Func<T, TResult>> selector, CancellationToken token = default) => global::LanguageExt.Eff<RT, TResult>.LiftIO(async rt => (await query(rt).MinAsync(selector, token))!);
#endregion
    /// <summary>
    /// An ordered query builder that supports ThenBy operations.
    /// </summary>
    public sealed class DbSetOrderedQuery(global::System.Func<RT, global::System.Linq.IOrderedQueryable<T>> query)
    {
#region Ordering Operations
        /// <summary>
        /// Performs a subsequent ordering in ascending order.
        /// </summary>
        /// <param name="keySelector">The LINQ expression representing the key to sort by.</param>
        /// <returns>A new ordered query instance.</returns>
        public DbSetOrderedQuery ThenBy<TKey>(global::System.Linq.Expressions.Expression<global::System.Func<T, TKey>> keySelector) => new DbSetOrderedQuery(rt => query(rt).ThenBy(keySelector));
        /// <summary>
        /// Performs a subsequent ordering in descending order.
        /// </summary>
        /// <param name="keySelector">The LINQ expression representing the key to sort by.</param>
        /// <returns>A new ordered query instance.</returns>
        public DbSetOrderedQuery ThenByDescending<TKey>(global::System.Linq.Expressions.Expression<global::System.Func<T, TKey>> keySelector) => new DbSetOrderedQuery(rt => query(rt).ThenByDescending(keySelector));
#endregion
#region Pagination Operations
        /// <summary>
        /// Bypasses a specified number of elements.
        /// </summary>
        /// <param name="count">The number of elements to skip.</param>
        /// <returns>A new query instance with the skip applied.</returns>
        public DbSetQuery<RT, T> Skip(int count) => new DbSetQuery<RT, T>(rt => query(rt).Skip(count));
        /// <summary>
        /// Returns a specified number of elements.
        /// </summary>
        /// <param name="count">The number of elements to return.</param>
        /// <returns>A new query instance with the take applied.</returns>
        public DbSetQuery<RT, T> Take(int count) => new DbSetQuery<RT, T>(rt => query(rt).Take(count));
#endregion
#region Terminal Effects
        /// <summary>
        /// Executes the query and returns all results as a list.
        /// </summary>
        /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
        /// <returns>An effect that yields a list of all matching elements.</returns>
        public global::LanguageExt.Eff<RT, global::System.Collections.Generic.List<T>> ToListAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, global::System.Collections.Generic.List<T>>.LiftIO(async rt => await query(rt).ToListAsync(token));
        /// <summary>
        /// Executes the query and returns all results as an array.
        /// </summary>
        /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
        /// <returns>An effect that yields an array of all matching elements.</returns>
        public global::LanguageExt.Eff<RT, T[]> ToArrayAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, T[]>.LiftIO(async rt => await query(rt).ToArrayAsync(token));
        /// <summary>
        /// Returns the first element, or None if the sequence is empty.
        /// </summary>
        /// <param name="token">A cancellation token to observe while waiting for the task to complete.</param>
        /// <returns>An effect that yields the first element wrapped in an Option, or None.</returns>
        public global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>> FirstOrNoneAsync(CancellationToken token = default) => global::LanguageExt.Eff<RT, global::LanguageExt.Option<T>>.LiftIO(async rt => Optional(await query(rt).FirstOrDefaultAsync(token)));
#endregion
    }
}