// <auto-generated/>
// SPDX-License-Identifier: RPL-1.5
// Copyright (c) Deepstaging contributors. All rights reserved.
// Licensed under the Reciprocal Public License 1.5 (RPL-1.5).
// See LICENSE file in the project root for full license information.
#nullable enable
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using System;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;

namespace TestApp;
/// <summary>
/// Interface for the <c>DatabaseConfigProvider</c> configuration provider.
/// </summary>
public interface IDatabaseConfigProvider
{
    /// <summary>
    /// Gets the <see cref="DbSecrets"/> configuration.
    /// </summary>
    public global::TestApp.DbSecrets DbSecrets { get; }
}

public partial class DatabaseConfigProvider(global::Microsoft.Extensions.Configuration.IConfiguration configuration) : IDatabaseConfigProvider
{
    private readonly global::Microsoft.Extensions.Configuration.IConfigurationSection _section = configuration.GetSection("Database");
    /// <summary>
    /// Gets the <see cref="DbSecrets"/> configuration.
    /// </summary>
    public global::TestApp.DbSecrets DbSecrets => _section.GetSection("DbSecrets").Get<global::TestApp.DbSecrets>()!;
}

public static class DatabaseConfigProviderExtensions
{
    /// <summary>
    /// Adds configuration sources for <see cref="DatabaseConfigProvider"/>.
    /// </summary>
    /// <param name="builder">The configuration builder.</param>
    /// <param name="settingsPath">Optional path to the settings file. Defaults to &lt;c&gt;deepstaging.settings.json&lt;/c&gt;.</param>
    /// <returns>The configuration builder for fluent chaining.</returns>
    public static global::Microsoft.Extensions.Configuration.IConfigurationBuilder ConfigureDatabaseConfigProviderSources(this global::Microsoft.Extensions.Configuration.IConfigurationBuilder builder, string? settingsPath = null)
    {
        builder.AddJsonFile(settingsPath ?? "deepstaging.settings.json", optional: true, reloadOnChange: true);
        builder.AddUserSecrets(typeof(DatabaseConfigProvider).Assembly, optional: true);
        return builder;
    }

    /// <summary>
    /// Registers <see cref="DatabaseConfigProvider"/> and <see cref="IDatabaseConfigProvider"/> with the service collection.
    /// </summary>
    /// <param name="services">The service collection.</param>
    /// <param name="configuration">The application configuration.</param>
    /// <returns>The service collection for fluent chaining.</returns>
    public static global::Microsoft.Extensions.DependencyInjection.IServiceCollection AddDatabaseConfigProvider(this global::Microsoft.Extensions.DependencyInjection.IServiceCollection services, global::Microsoft.Extensions.Configuration.IConfiguration configuration)
    {
        var provider = new DatabaseConfigProvider(configuration);
        services.AddSingleton<IDatabaseConfigProvider>(provider);
        return services;
    }
}