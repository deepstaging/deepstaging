// <auto-generated/>
// SPDX-License-Identifier: RPL-1.5
// Copyright (c) Deepstaging contributors. All rights reserved.
// Licensed under the Reciprocal Public License 1.5 (RPL-1.5).
// See LICENSE file in the project root for full license information.
#nullable enable
using System;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;
using TestApp;

namespace TestApp;
/// <summary>
/// Configures the <c>StubSlackService</c> stub using a builder delegate.
/// </summary>
/// <param name="configure">A delegate that receives the current stub (or a new default) and returns the configured stub.</param>
/// <returns>This test runtime instance for fluent chaining.</returns>
public partial class TestAppRuntime : global::TestApp.IAppRuntimeCapabilities, global::Deepstaging.ITestRuntime<global::TestApp.TestAppRuntime>
{
    private global::TestApp.IEmailService? _emailService;
    private global::TestApp.ISlackService? _slackService;
    /// <summary>
    /// Gets the <c>IEmailService</c> capability, or throws if not configured.
    /// </summary>
    /// <exception cref="global::System.InvalidOperationException">Thrown if the capability has not been configured.</exception>
    public global::TestApp.IEmailService EmailService => _emailService ?? throw new global::System.InvalidOperationException("Service 'EmailService' has not been configured on TestAppRuntime. Use .WithEmailService() to configure it.");
    /// <summary>
    /// Gets the <c>ISlackService</c> capability, or throws if not configured.
    /// </summary>
    /// <exception cref="global::System.InvalidOperationException">Thrown if the capability has not been configured.</exception>
    public global::TestApp.ISlackService SlackService => _slackService ?? throw new global::System.InvalidOperationException("Service 'SlackService' has not been configured on TestAppRuntime. Use .WithSlackService() to configure it.");

    /// <summary>
    /// Configures the <c>EmailService</c> capability with the specified implementation.
    /// </summary>
    /// <param name="emailService">The IEmailService implementation to use.</param>
    /// <returns>This test runtime instance for fluent chaining.</returns>
    public TestAppRuntime WithEmailService(global::TestApp.IEmailService emailService)
    {
        _emailService = emailService;
        return this;
    }

    public TestAppRuntime WithStubEmailService(global::System.Func<StubEmailService, StubEmailService> configure)
    {
        _emailService = configure(_emailService as StubEmailService ?? new StubEmailService());
        return this;
    }

    /// <summary>
    /// Configures the <c>SlackService</c> capability with the specified implementation.
    /// </summary>
    /// <param name="slackService">The ISlackService implementation to use.</param>
    /// <returns>This test runtime instance for fluent chaining.</returns>
    public TestAppRuntime WithSlackService(global::TestApp.ISlackService slackService)
    {
        _slackService = slackService;
        return this;
    }

    public TestAppRuntime WithStubSlackService(global::System.Func<StubSlackService, StubSlackService> configure)
    {
        _slackService = configure(_slackService as StubSlackService ?? new StubSlackService());
        return this;
    }

    /// <summary>
    /// Creates a new <c>TestAppRuntime</c> instance with all capabilities unconfigured. Use <c>.With*()</c> methods to configure.
    /// </summary>
    /// <returns>A new test runtime instance.</returns>
    public static global::TestApp.TestAppRuntime Create()
    {
        return new global::TestApp.TestAppRuntime();
    }

    /// <summary>
    /// Configurable stub implementation of <c>IEmailService</c> for testing. Each method delegates to an optional <c>Func</c> property.
    /// </summary>
    public partial record StubEmailService(global::System.Func<String, String, String, Task>? onSendAsync = null) : global::TestApp.IEmailService
    {
        /// <summary>
        /// Stub implementation that delegates to <see cref="onSendAsync"/> if configured, or returns a default value.
        /// </summary>
        global::System.Threading.Tasks.Task global::TestApp.IEmailService.SendAsync(string to, string subject, string body) => onSendAsync?.Invoke(to, subject, body) ?? global::System.Threading.Tasks.Task.CompletedTask;
        /// <summary>
        /// Returns a new StubEmailService with the specified behavior configured for the SendAsync method.
        /// </summary>
        /// <param name="configure">global::System.Func&lt;String, String, String, Task&gt;</param>
        /// <returns>A new StubEmailService instance with the configured behavior.</returns>
        public StubEmailService OnSendAsync(global::System.Func<String, String, String, Task> configure) => this with
        {
            onSendAsync = configure
        };
    }

    /// <summary>
    /// Configurable stub implementation of <c>ISlackService</c> for testing. Each method delegates to an optional <c>Func</c> property.
    /// </summary>
    public partial record StubSlackService(global::System.Func<String, String, Task>? onPostMessageAsync = null) : global::TestApp.ISlackService
    {
        /// <summary>
        /// Stub implementation that delegates to <see cref="onPostMessageAsync"/> if configured, or returns a default value.
        /// </summary>
        global::System.Threading.Tasks.Task global::TestApp.ISlackService.PostMessageAsync(string channel, string message) => onPostMessageAsync?.Invoke(channel, message) ?? global::System.Threading.Tasks.Task.CompletedTask;
        /// <summary>
        /// Returns a new StubSlackService with the specified behavior configured for the PostMessageAsync method.
        /// </summary>
        /// <param name="configure">global::System.Func&lt;String, String, Task&gt;</param>
        /// <returns>A new StubSlackService instance with the configured behavior.</returns>
        public StubSlackService OnPostMessageAsync(global::System.Func<String, String, Task> configure) => this with
        {
            onPostMessageAsync = configure
        };
    }
}