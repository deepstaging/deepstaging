// <auto-generated/>
// SPDX-License-Identifier: RPL-1.5
// Copyright (c) Deepstaging contributors. All rights reserved.
// Licensed under the Reciprocal Public License 1.5 (RPL-1.5).
// See LICENSE file in the project root for full license information.
#nullable enable
using Deepstaging;
using Deepstaging.Runtime;
using LanguageExt;
using LanguageExt.Effects;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq.Expressions;
using System.Threading;
using System.Threading.Tasks;
using static LanguageExt.Prelude;

namespace Deepstaging.ToDo;
public static partial class ToDoEffects
{
    public static partial class Database
    {
        private static readonly ActivitySource ActivitySource = new("Deepstaging.ToDo.Database", "1.0.0");

        /// <summary>
        /// Saves all changes made in this context to the database asynchronously.
        /// </summary>
        public static Eff<RT, int> SaveChangesAsync<RT>(CancellationToken token = default)
            where RT : IHasTodoDbContext => liftEff<RT, int>(async rt => await rt.TodoDbContext.SaveChangesAsync(token)).WithActivity("Database.SaveChangesAsync", ActivitySource);

        public static partial class TodoItems
        {
            /// <summary>
            /// Returns a composable query builder for this entity set.
            /// Chain LINQ methods and call a terminal operation (ToListAsync, FirstOrNoneAsync, etc.) to execute.
            /// </summary>
            public static DbSetQuery<RT, global::Deepstaging.ToDo.Services.Data.TodoItem> Query<RT>()
                where RT : IHasTodoDbContext => new(rt => rt.TodoDbContext.TodoItems);

            /// <summary>
            /// Finds an entity by its primary key values, returning None if not found.
            /// </summary>
            public static Eff<RT, Option<global::Deepstaging.ToDo.Services.Data.TodoItem>> FindAsync<RT>(params object[] keyValues)
                where RT : IHasTodoDbContext => liftEff<RT, Option<global::Deepstaging.ToDo.Services.Data.TodoItem>>(async rt => Optional(await rt.TodoDbContext.TodoItems.FindAsync(keyValues))).WithActivity("Database.TodoItems.FindAsync", ActivitySource);

            /// <summary>
            /// Returns all entities as a list.
            /// </summary>
            public static Eff<RT, List<global::Deepstaging.ToDo.Services.Data.TodoItem>> ToListAsync<RT>(CancellationToken token = default)
                where RT : IHasTodoDbContext => Query<RT>().ToListAsync(token).WithActivity("Database.TodoItems.ToListAsync", ActivitySource);

            /// <summary>
            /// Returns the first entity matching the predicate, or None.
            /// </summary>
            public static Eff<RT, Option<global::Deepstaging.ToDo.Services.Data.TodoItem>> FirstOrNoneAsync<RT>(Expression<Func<global::Deepstaging.ToDo.Services.Data.TodoItem, bool>> predicate, CancellationToken token = default)
                where RT : IHasTodoDbContext => Query<RT>().FirstOrNoneAsync(predicate, token).WithActivity("Database.TodoItems.FirstOrNoneAsync", ActivitySource);

            /// <summary>
            /// Returns the count of entities.
            /// </summary>
            public static Eff<RT, int> CountAsync<RT>(CancellationToken token = default)
                where RT : IHasTodoDbContext => Query<RT>().CountAsync(token).WithActivity("Database.TodoItems.CountAsync", ActivitySource);

            /// <summary>
            /// Returns true if any entities exist.
            /// </summary>
            public static Eff<RT, bool> AnyAsync<RT>(CancellationToken token = default)
                where RT : IHasTodoDbContext => Query<RT>().AnyAsync(token).WithActivity("Database.TodoItems.AnyAsync", ActivitySource);

            /// <summary>
            /// Begins tracking the entity in the Added state.
            /// </summary>
            public static Eff<RT, Unit> Add<RT>(global::Deepstaging.ToDo.Services.Data.TodoItem entity)
                where RT : IHasTodoDbContext => liftEff<RT, Unit>(rt =>
            {
                rt.TodoDbContext.TodoItems.Add(entity);
                return unit;
            }).WithActivity("Database.TodoItems.Add", ActivitySource);

            /// <summary>
            /// Begins tracking the entities in the Added state.
            /// </summary>
            public static Eff<RT, Unit> AddRange<RT>(params global::Deepstaging.ToDo.Services.Data.TodoItem[] entities)
                where RT : IHasTodoDbContext => liftEff<RT, Unit>(rt =>
            {
                rt.TodoDbContext.TodoItems.AddRange(entities);
                return unit;
            }).WithActivity("Database.TodoItems.AddRange", ActivitySource);

            /// <summary>
            /// Begins tracking the entity in the Modified state.
            /// </summary>
            public static Eff<RT, Unit> Update<RT>(global::Deepstaging.ToDo.Services.Data.TodoItem entity)
                where RT : IHasTodoDbContext => liftEff<RT, Unit>(rt =>
            {
                rt.TodoDbContext.TodoItems.Update(entity);
                return unit;
            }).WithActivity("Database.TodoItems.Update", ActivitySource);

            /// <summary>
            /// Begins tracking the entity in the Deleted state.
            /// </summary>
            public static Eff<RT, Unit> Remove<RT>(global::Deepstaging.ToDo.Services.Data.TodoItem entity)
                where RT : IHasTodoDbContext => liftEff<RT, Unit>(rt =>
            {
                rt.TodoDbContext.TodoItems.Remove(entity);
                return unit;
            }).WithActivity("Database.TodoItems.Remove", ActivitySource);
        }
    }
}